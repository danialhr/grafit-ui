name: Build

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  # Build example app
  build-example:
    name: Build Example App
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.24.0'
          channel: 'stable'
          cache: true
      
      - name: Install dependencies
        working-directory: packages/grafit_ui/example
        run: flutter pub get
      
      - name: Build example app (Android)
        working-directory: packages/grafit_ui/example
        run: flutter build apk --debug
      
      - name: Build example app (Web)
        working-directory: packages/grafit_ui/example
        run: flutter build web --no-tree-shake-icons
      
      - name: Upload Android APK
        uses: actions/upload-artifact@v4
        with:
          name: example-apk
          path: packages/grafit_ui/example/build/app/outputs/flutter-apk/
          retention-days: 7

  # Build Widgetbook
  build-widgetbook:
    name: Build Widgetbook
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.24.0'
          channel: 'stable'
          cache: true
      
      - name: Install dependencies
        working-directory: packages/widgetbook
        run: flutter pub get
      
      - name: Run build_runner
        working-directory: packages/widgetbook
        run: flutter pub run build_runner build --delete-conflicting-outputs
      
      - name: Build Widgetbook (Web)
        working-directory: packages/widgetbook
        run: flutter build web --no-tree-shake-icons
      
      - name: Upload Widgetbook
        uses: actions/upload-artifact@v4
        with:
          name: widgetbook-web
          path: packages/widgetbook/build/web/
          retention-days: 7
